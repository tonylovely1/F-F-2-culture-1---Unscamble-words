<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review FAF 5 (Units 1-3): Vocabulary Scramble</title>
    <!-- T·∫£i Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Thi·∫øt l·∫≠p c·∫•u h√¨nh Tailwind v√† Font Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* M√†u n·ªÅn nh·∫π nh√†ng */
        }
        .letter-tile {
            cursor: grab;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .letter-tile:active {
            cursor: grabbing;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: scale(1.05);
        }
        .drop-zone {
            transition: background-color 0.15s, border-color 0.15s;
        }
        .drop-zone.drag-over {
            background-color: #d1fae5; /* M√†u xanh nh·∫°t khi k√©o v√†o */
            border-color: #10b981;
        }
        /* Style cho n√∫t b·ªã disabled */
        button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
            transform: none !important;
            box-shadow: none;
        }
        .correct {
            background-color: #d1fae5 !important; /* Xanh l√° */
            border-color: #059669 !important;
        }
        .incorrect {
            background-color: #fee2e2 !important; /* ƒê·ªè nh·∫°t */
            border-color: #ef4444 !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <!-- Ti√™u ƒë·ªÅ v√† ƒê·ªìng h·ªì b·∫•m gi·ªù -->
    <header class="w-full max-w-4xl mb-6 bg-white shadow-lg rounded-xl p-4 flex flex-col sm:flex-row justify-between items-center sticky top-4 z-10">
        <h1 class="text-xl sm:text-2xl font-extrabold text-indigo-700 mb-2 sm:mb-0">
            Review FAF 5: Vocabulary Scramble
        </h1>
        <div id="timer" class="text-3xl font-mono font-bold text-gray-800 bg-gray-100 px-4 py-2 rounded-lg shadow-inner">
            00:00
        </div>
    </header>

    <!-- Khu v·ª±c Tr√≤ ch∆°i Ch√≠nh -->
    <main class="w-full max-w-4xl bg-white p-6 md:p-8 rounded-xl shadow-2xl">
        <div id="game-info" class="text-center mb-6">
            <div id="progress" class="text-lg font-semibold text-gray-500">T·ª´ 1/10</div>
            <div id="current-icon" class="text-4xl mt-2 mb-4"></div>
            <div id="status-message" class="h-8 text-xl font-bold mt-2"></div>
        </div>

        <!-- C√°c √¥ th·∫£ (Drop Zones) -->
        <div id="drop-zones-container" class="flex flex-wrap justify-center gap-2 sm:gap-4 mb-8 min-h-[64px]">
            <!-- Drop zones s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS t·∫°i ƒë√¢y -->
        </div>

        <!-- Ng√¢n h√†ng Ch·ªØ c√°i (Letter Bank) -->
        <div class="text-center mb-6">
            <h3 class="text-lg font-semibold text-gray-600 mb-3">Ng√¢n h√†ng Ch·ªØ c√°i (K√©o v√† Th·∫£)</h3>
            <div id="letter-bank" class="flex flex-wrap justify-center gap-2 sm:gap-3 bg-indigo-50 p-4 rounded-lg shadow-inner min-h-[60px]">
                <!-- Ch·ªØ c√°i draggable s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS t·∫°i ƒë√¢y -->
            </div>
        </div>

        <!-- Khu v·ª±c Ki·ªÉm tra v√† K·∫øt th√∫c -->
        <div id="action-area" class="flex justify-center mt-6 space-x-4 flex-wrap gap-3">
            <button id="speak-button" class="px-6 py-3 bg-purple-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-purple-700 transition duration-150 transform hover:scale-105">
                üîä Nghe T·ª´
            </button>
            <button id="reset-button" class="px-6 py-3 bg-yellow-500 text-gray-800 font-bold text-lg rounded-lg shadow-md hover:bg-yellow-600 transition duration-150 transform hover:scale-105">
                üîÑ Th·ª≠ L·∫°i
            </button>
            <button id="check-button" class="px-8 py-3 bg-green-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-green-700 transition duration-150 transform hover:scale-105" disabled>
                ‚úÖ Check Word
            </button>
        </div>

        <!-- Modal K·∫øt qu·∫£ -->
        <div id="result-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
            <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full text-center">
                <div id="modal-icon" class="text-6xl mb-4"></div>
                <h2 id="modal-title" class="text-3xl font-bold text-gray-800 mb-4"></h2>
                <p id="modal-message" class="text-lg text-gray-600 mb-6"></p>
                <button id="modal-close-button" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition">
                    Ti·∫øp t·ª•c
                </button>
            </div>
        </div>
    </main>

    <script>
        // C√°c bi·∫øn to√†n c·ª•c v√† C·∫•u h√¨nh
        const VOCABULARY_LIST = [
            // Unit 1: Daily Routines [1]
            { id: 1, word: "HOMEWORK", icon: "üìö" },
            { id: 2, word: "SHOWER", icon: "üöø" },
            { id: 3, word: "BUS", icon: "üöå" },
            // Unit 2: Places and Entertainment [1, 7]
            { id: 4, word: "MARKET", icon: "üçé" },
            { id: 5, word: "PLAYGROUND", icon: "üõù" },
            { id: 6, word: "CONCERT", icon: "üé§" },
            { id: 7, word: "ACTOR", icon: "üé≠" },
            // Unit 3: Food and Drinks [7]
            { id: 8, word: "GARLIC", icon: "üßÑ" },
            { id: 9, word: "CUCUMBER", icon: "ü•í" },
            { id: 10, word: "LEMONADE", icon: "üçã" }
        ];

        let currentWordIndex = 0;
        let timerInterval;
        let startTime;
        let gameRunning = false;
        let currentGuess = []; // M·∫£ng ch·ª©a c√°c ch·ªØ c√°i hi·ªán t·∫°i trong drop zones
        let draggedData = null; // D·ªØ li·ªáu c·ªßa √¥ ch·ªØ c√°i ƒëang ƒë∆∞·ª£c k√©o

        const $ = selector => document.querySelector(selector);
        const $$ = selector => document.querySelectorAll(selector);

        // --- UTILITY FUNCTIONS ---

        // X√°o tr·ªôn m·∫£ng (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ƒê·ªãnh d·∫°ng th·ªùi gian
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }
        
        // OFFLINE TTS LOGIC (Web Speech API)
        let speechSynth = window.speechSynthesis;
        let englishVoice = null;

        function getEnglishVoice() {
            if (englishVoice) return englishVoice;
            const voices = speechSynth.getVoices();
            // C·ªë g·∫Øng t√¨m gi·ªçng US English
            englishVoice = voices.find(voice => voice.lang === 'en-US') ||
                           voices.find(voice => voice.lang.startsWith('en')) ||
                           voices[0]; // Gi·ªçng m·∫∑c ƒë·ªãnh
            return englishVoice;
        }
        if (speechSynth.onvoiceschanged !== undefined) {
            speechSynth.onvoiceschanged = getEnglishVoice;
        }

        /** ƒê·ªçc t·ª´ hi·ªán t·∫°i b·∫±ng TTS (Offline) */
        function speakCurrentWord() {
            if (!speechSynth || speechSynth.speaking) return;

            const currentWord = VOCABULARY_LIST[currentWordIndex].word;

            const speakButton = $('#speak-button');
            speakButton.disabled = true;
            speakButton.textContent = 'üîä ƒêang n√≥i...';

            const utterance = new SpeechSynthesisUtterance(currentWord);
            utterance.lang = 'en-US';
            utterance.voice = getEnglishVoice();
            utterance.rate = 0.9; // T·ªëc ƒë·ªô v·ª´a ph·∫£i

            utterance.onend = () => {
                speakButton.textContent = 'üîä Nghe T·ª´';
                speakButton.disabled = false;
            };
            utterance.onerror = () => {
                speakButton.textContent = 'üîä Nghe T·ª´';
                speakButton.disabled = false;
            };

            speechSynth.speak(utterance);
        }

        // ----------------------------------------------------
        // Logic ƒê·ªìng h·ªì b·∫•m gi·ªù
        // ----------------------------------------------------

        function startTimer() {
            if (gameRunning) return;
            gameRunning = true;
            startTime = Date.now();

            timerInterval = setInterval(() => {
                const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
                $('#timer').textContent = formatTime(elapsedSeconds);
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            gameRunning = false;
        }

        // ----------------------------------------------------
        // Logic K√©o v√† Th·∫£ (Drag and Drop) - ƒê√É FIX
        // ----------------------------------------------------

        // S·ª± ki·ªán B·∫Øt ƒë·∫ßu k√©o
        function handleDragStart(e) {
            const sourceElement = e.target;
            
            // Ch·ªâ k√©o ch·ªØ c√°i (c√≥ class letter-tile)
            if (!sourceElement.classList.contains('letter-tile')) {
                e.preventDefault();
                return;
            }

            const letter = sourceElement.textContent.trim();
            const sourceId = sourceElement.id;
            
            draggedData = {
                letter: letter,
                sourceId: sourceId, // 'bank-X' ho·∫∑c 'slot-X'
                sourceElement: sourceElement,
            };

            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', letter);

            // Th√™m class m·ªù cho ch·ªØ c√°i ƒëang k√©o
            setTimeout(() => sourceElement.classList.add('opacity-40'), 0);
        }

        // S·ª± ki·ªán K·∫øt th√∫c k√©o (ƒë·ªÉ x√≥a hi·ªáu ·ª©ng m·ªù)
        function handleDragEnd(e) {
            if (e.target) {
                e.target.classList.remove('opacity-40');
            }
            draggedData = null;
        }

        // S·ª± ki·ªán K√©o tr√™n √¥ th·∫£ (ƒê·ªÉ cho ph√©p th·∫£)
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            const dropTarget = e.target.closest('.drop-zone') || e.target.closest('#letter-bank');
            $$('.drop-zone').forEach(el => el.classList.remove('drag-over'));
            
            if (dropTarget && dropTarget.classList.contains('drop-zone')) {
                dropTarget.classList.add('drag-over');
            }
        }

        // S·ª± ki·ªán Th·∫£ (Logic ch√≠nh ƒë√£ ƒë∆∞·ª£c s·ª≠a)
        function handleDrop(e) {
            e.preventDefault();
            
            // X√≥a hi·ªáu ·ª©ng drag-over
            $$('.drop-zone').forEach(el => el.classList.remove('drag-over'));
            
            const dropTarget = e.target.closest('.drop-zone') || e.target.closest('#letter-bank');
            if (!dropTarget || !draggedData) return;

            const droppedLetter = draggedData.letter;
            const sourceElement = draggedData.sourceElement;
            const sourceId = draggedData.sourceId;
            
            if (sourceElement) {
                sourceElement.classList.remove('opacity-40');
            }
            
            // 1. K√©o t·ª´ Slot v√†o Bank (Chuy·ªÉn v·ªÅ Ng√¢n h√†ng)
            if (dropTarget.id === 'letter-bank' && sourceId.startsWith('slot-')) {
                
                // 1a. D·ªçn d·∫πp Slot ngu·ªìn
                const sourceIndex = parseInt(sourceId.split('-')[1]);
                currentGuess[sourceIndex] = null;
                
                sourceElement.textContent = '';
                sourceElement.draggable = false;
                sourceElement.classList.remove('letter-tile', 'bg-white', 'shadow-md');
                sourceElement.classList.add('bg-gray-200');

                // 1b. T·∫°o vi√™n g·∫°ch m·ªõi trong Bank
                const newTile = document.createElement('div');
                newTile.id = `bank-${Date.now()}-${Math.random()}`; // ID ng·∫´u nhi√™n
                newTile.className = 'letter-tile bg-yellow-400 text-gray-900 font-extrabold text-2xl w-12 h-12 flex items-center justify-center rounded-lg shadow-md uppercase select-none';
                newTile.textContent = droppedLetter;
                newTile.draggable = true;
                dropTarget.appendChild(newTile);
                
                // G·∫Øn l·∫°i listener cho tile m·ªõi
                newTile.addEventListener('dragstart', handleDragStart);
                newTile.addEventListener('dragend', handleDragEnd);

            } 
            
            // 2. K√©o v√†o Drop Zone
            else if (dropTarget.classList.contains('drop-zone')) {
                
                const targetIndex = parseInt(dropTarget.dataset.index);
                const currentTargetLetter = dropTarget.textContent.trim();
                
                // 2a. X·ª≠ l√Ω ngu·ªìn (Bank ho·∫∑c Slot)
                if (sourceId.startsWith('bank-')) {
                    // Ngu·ªìn l√† Bank: X√≥a tile kh·ªèi Bank
                    sourceElement.remove();
                } else if (sourceId.startsWith('slot-')) {
                    // Ngu·ªìn l√† Slot: D·ªçn d·∫πp slot ngu·ªìn ho·∫∑c chu·∫©n b·ªã cho Swap
                    const sourceIndex = parseInt(sourceId.split('-')[1]);
                    
                    if (currentTargetLetter) {
                        // SWAP: Slot ƒë√≠ch ƒë√£ c√≥ ch·ªØ c√°i -> Ho√°n ƒë·ªïi
                        
                        // C·∫≠p nh·∫≠t m·∫£ng guess
                        currentGuess[sourceIndex] = currentTargetLetter;
                        
                        // C·∫≠p nh·∫≠t DOM ngu·ªìn
                        sourceElement.textContent = currentTargetLetter;
                        sourceElement.draggable = true;
                        
                    } else {
                        // MOVE: Slot ƒë√≠ch tr·ªëng -> D·ªçn d·∫πp Slot ngu·ªìn
                        
                        // C·∫≠p nh·∫≠t m·∫£ng guess
                        currentGuess[sourceIndex] = null;
                        
                        // C·∫≠p nh·∫≠t DOM ngu·ªìn
                        sourceElement.textContent = '';
                        sourceElement.draggable = false;
                        sourceElement.classList.remove('letter-tile', 'bg-white', 'shadow-md');
                        sourceElement.classList.add('bg-gray-200');
                    }
                }
                
                // 2b. X·ª≠ l√Ω ƒë√≠ch (Drop Zone)
                currentGuess[targetIndex] = droppedLetter;
                
                dropTarget.textContent = droppedLetter;
                dropTarget.draggable = true;
                dropTarget.classList.remove('bg-gray-200');
                dropTarget.classList.add('letter-tile', 'bg-white', 'shadow-md');
            }

            updateCheckButtonStatus();
            draggedData = null; 
            attachDragListeners();
        }
        
        // G·∫Øn t·∫•t c·∫£ s·ª± ki·ªán k√©o v√† th·∫£
        function attachDragListeners() {
            // Ng√¢n h√†ng ch·ªØ c√°i
            $$('#letter-bank .letter-tile').forEach(tile => {
                tile.removeEventListener('dragstart', handleDragStart);
                tile.addEventListener('dragstart', handleDragStart);
                tile.removeEventListener('dragend', handleDragEnd);
                tile.addEventListener('dragend', handleDragEnd);
            });

            // C√°c √¥ th·∫£
            $$('.drop-zone').forEach(slot => {
                slot.removeEventListener('dragstart', handleDragStart);
                slot.addEventListener('dragstart', handleDragStart);
                slot.removeEventListener('dragend', handleDragEnd);
                slot.addEventListener('dragend', handleDragEnd);
                
                slot.removeEventListener('dragover', handleDragOver);
                slot.addEventListener('dragover', handleDragOver);
                slot.removeEventListener('dragleave', handleDragOver); // d√πng dragover ƒë·ªÉ x√≥a hi·ªáu ·ª©ng
                slot.removeEventListener('drop', handleDrop);
                slot.addEventListener('drop', handleDrop);
            });
        }


        // ----------------------------------------------------
        // Logic Game
        // ----------------------------------------------------

        // Kh·ªüi t·∫°o Game
        function initGame() {
            startTimer();
            loadWord(currentWordIndex);
            
            $('#check-button').addEventListener('click', checkWord);
            $('#reset-button').addEventListener('click', resetCurrentWord);
            $('#speak-button').addEventListener('click', speakCurrentWord);
            $('#modal-close-button').addEventListener('click', handleModalClose);
        }

        /** ƒê·∫∑t l·∫°i t·ª´ hi·ªán t·∫°i: X√≥a slots v√† t·∫°o l·∫°i ng√¢n h√†ng ch·ªØ c√°i */
        function resetCurrentWord() {
            const currentWord = VOCABULARY_LIST[currentWordIndex].word;
            const letters = currentWord.split('');

            // 1. X√≥a n·ªôi dung slots
            $$('.drop-zone').forEach(zone => {
                zone.textContent = '';
                zone.draggable = false;
                zone.classList.remove('letter-tile', 'bg-white', 'shadow-md', 'correct', 'incorrect');
                zone.classList.add('bg-gray-200');
            });
            currentGuess = Array(currentWord.length).fill(null);

            // 2. T√°i t·∫°o ng√¢n h√†ng ch·ªØ c√°i ƒë√£ x√°o tr·ªôn
            const shuffledLetters = shuffleArray([...letters]);

            const letterBankContainer = $('#letter-bank');
            letterBankContainer.innerHTML = '';

            shuffledLetters.forEach((letter, i) => {
                const tile = document.createElement('div');
                tile.id = `bank-${i}`;
                tile.className = 'letter-tile bg-yellow-400 text-gray-900 font-extrabold text-2xl w-12 h-12 flex items-center justify-center rounded-lg shadow-md uppercase select-none';
                tile.textContent = letter;
                tile.draggable = true;
                letterBankContainer.appendChild(tile);
            });
            
            // G·∫Øn l·∫°i s·ª± ki·ªán k√©o th·∫£
            attachDragListeners();
            updateCheckButtonStatus();
            $('#status-message').textContent = 'üîÑ ƒê√£ th·ª≠ l·∫°i. S·∫Øp x·∫øp c√°c ch·ªØ c√°i.';
            $('#status-message').className = 'h-8 text-xl font-bold mt-2 text-gray-600';
        }


        // T·∫£i t·ª´ v·ª±ng hi·ªán t·∫°i
        function loadWord(index) {
            if (index >= VOCABULARY_LIST.length) {
                finishGame();
                return;
            }
            
            // ƒê·∫£m b·∫£o kh√¥ng c√≤n hi·ªáu ·ª©ng c≈©
            if (speechSynth.speaking) {
                speechSynth.cancel();
            }

            const currentWord = VOCABULARY_LIST[index].word;
            const icon = VOCABULARY_LIST[index].icon;
            
            // Reset tr·∫°ng th√°i
            currentGuess = Array(currentWord.length).fill(null);
            $('#status-message').textContent = '';
            updateCheckButtonStatus();
            
            // C·∫≠p nh·∫≠t th√¥ng tin
            $('#progress').textContent = `T·ª´ ${index + 1}/${VOCABULARY_LIST.length}`;
            $('#current-icon').textContent = icon;

            // X√¢y d·ª±ng Ng√¢n h√†ng Ch·ªØ c√°i
            const letters = currentWord.split('');
            const shuffledLetters = shuffleArray([...letters]); // Sao ch√©p v√† x√°o tr·ªôn

            const letterBankContainer = $('#letter-bank');
            letterBankContainer.innerHTML = ''; // X√≥a ch·ªØ c√°i c≈©

            shuffledLetters.forEach((letter, i) => {
                const tile = document.createElement('div');
                tile.id = `bank-${i}`;
                tile.className = 'letter-tile bg-yellow-400 text-gray-900 font-extrabold text-2xl w-12 h-12 flex items-center justify-center rounded-lg shadow-md uppercase select-none';
                tile.textContent = letter;
                tile.draggable = true;
                letterBankContainer.appendChild(tile);
            });

            // X√¢y d·ª±ng √î th·∫£
            const dropZonesContainer = $('#drop-zones-container');
            dropZonesContainer.innerHTML = ''; // X√≥a √¥ th·∫£ c≈©

            for (let i = 0; i < currentWord.length; i++) {
                const zone = document.createElement('div');
                zone.id = `slot-${i}`;
                zone.dataset.index = i;
                zone.className = 'drop-zone bg-gray-200 border-2 border-dashed border-gray-400 w-16 h-16 flex items-center justify-center rounded-lg text-2xl font-bold text-gray-700 uppercase select-none';
                zone.draggable = false;
                dropZonesContainer.appendChild(zone);
            }
            
            // G·∫Øn l·∫°i s·ª± ki·ªán k√©o th·∫£ cho c√°c ph·∫ßn t·ª≠ m·ªõi
            attachDragListeners();
        }

        // Ki·ªÉm tra T·ª´
        function checkWord() {
            const currentWord = VOCABULARY_LIST[currentWordIndex].word;
            const guessedWord = currentGuess.join('');
            
            const filledCount = currentGuess.filter(l => l !== null).length;
            
            if (filledCount !== currentWord.length) {
                showModal('‚ùì', 'Ch∆∞a ho√†n th√†nh', `B·∫°n c·∫ßn s·∫Øp x·∫øp ƒë·ªß ${currentWord.length} ch·ªØ c√°i.`);
                return;
            }

            if (guessedWord === currentWord) {
                handleCorrect();
            } else {
                handleIncorrect();
            }
        }

        // X·ª≠ l√Ω khi ƒë√∫ng
        function handleCorrect() {
            const word = VOCABULARY_LIST[currentWordIndex].word;
            
            // Hi·ªáu ·ª©ng v√† th√¥ng b√°o
            $$('.drop-zone').forEach(el => {
                el.classList.remove('bg-white', 'shadow-md', 'bg-gray-200', 'border-dashed', 'border-gray-400');
                el.classList.add('correct');
            });
            
            $('#status-message').textContent = `‚úÖ Ch√≠nh x√°c! (${word})`;
            $('#status-message').className = 'h-8 text-xl font-bold mt-2 text-green-700';
            
            // T·∫Øt t∆∞∆°ng t√°c trong th·ªùi gian chuy·ªÉn ti·∫øp
            setInteractivity(false);

            // Chu·∫©n b·ªã cho t·ª´ ti·∫øp theo
            currentWordIndex++;
            
            // Hi·ªÉn th·ªã modal (s·ª≠ d·ª•ng modal cho ph·∫£n h·ªìi t·ªët h∆°n)
            if (currentWordIndex < VOCABULARY_LIST.length) {
                showModal('ü•≥', 'Ch√≠nh x√°c!', `Tuy·ªát v·ªùi! T·ª´ ti·∫øp theo s·∫Ω ƒë∆∞·ª£c t·∫£i.`, true);
            } else {
                finishGame(); // K·∫øt th√∫c n·∫øu l√† t·ª´ cu·ªëi
            }
        }

        // X·ª≠ l√Ω khi sai
        function handleIncorrect() {
            $('#status-message').textContent = '‚ùå Sai r·ªìi. Th·ª≠ s·∫Øp x·∫øp l·∫°i nh√©!';
            $('#status-message').className = 'h-8 text-xl font-bold mt-2 text-red-600';

            // Hi·ªáu ·ª©ng rung
            $$('.drop-zone').forEach(el => {
                el.classList.add('incorrect');
                setTimeout(() => {
                    el.classList.remove('incorrect');
                }, 1000);
            });
        }
        
        /** Ki·ªÉm so√°t t∆∞∆°ng t√°c */
        function setInteractivity(isEnabled) {
            $('#check-button').disabled = !isEnabled;
            $('#reset-button').disabled = !isEnabled;
            $('#speak-button').disabled = !isEnabled;
            
            $$('.letter-tile').forEach(tile => {
                tile.draggable = isEnabled;
                tile.style.cursor = isEnabled ? 'grab' : 'not-allowed';
            });
        }

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t Check Word
        function updateCheckButtonStatus() {
            const currentWordLength = VOCABULARY_LIST[currentWordIndex]?.word.length || 0;
            const filledCount = currentGuess.filter(l => l !== null).length;
            const isReady = filledCount === currentWordLength;
            
            const checkButton = $('#check-button');
            checkButton.disabled = !isReady;
            checkButton.classList.toggle('bg-green-600', isReady);
            checkButton.classList.toggle('hover:bg-green-700', isReady);
            checkButton.classList.toggle('bg-gray-400', !isReady);
            checkButton.classList.toggle('hover:bg-gray-400', !isReady);
            checkButton.classList.toggle('transform', isReady);
            checkButton.classList.toggle('hover:scale-105', isReady);
        }

        // Hi·ªÉn th·ªã Modal
        function showModal(icon, title, message, isSuccess = false) {
            $('#modal-icon').textContent = icon;
            $('#modal-title').textContent = title;
            $('#modal-message').textContent = message;
            
            const closeButton = $('#modal-close-button');
            closeButton.textContent = isSuccess ? "Ti·∫øp t·ª•c" : "ƒê√£ hi·ªÉu";

            $('#result-modal').classList.remove('hidden');
        }
        
        // ƒê√≥ng Modal
        function handleModalClose() {
            $('#result-modal').classList.add('hidden');
            
            // N·∫øu l√† modal th√†nh c√¥ng, t·∫£i t·ª´ ti·∫øp theo
            if ($('#modal-title').textContent === 'Ch√≠nh x√°c!' && currentWordIndex < VOCABULARY_LIST.length) {
                setInteractivity(true);
                loadWord(currentWordIndex);
            }
        }

        // K·∫øt th√∫c Game
        function finishGame() {
            stopTimer();
            const finalTime = $('#timer').textContent;
            
            // ·∫®n khu v·ª±c ch∆°i v√† hi·ªÉn th·ªã th√¥ng b√°o cu·ªëi c√πng
            $('#drop-zones-container').innerHTML = '';
            $('#letter-bank').innerHTML = '';
            $('#action-area').innerHTML = '';
            
            showModal('üéâ', 'Ho√†n th√†nh!', `Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ ${VOCABULARY_LIST.length} t·ª´ trong th·ªùi gian: ${finalTime}.`, false);
            $('#modal-close-button').textContent = "Ch∆°i l·∫°i";
            $('#modal-close-button').onclick = () => window.location.reload(); // T·∫£i l·∫°i trang ƒë·ªÉ ch∆°i l·∫°i
            
            $('#progress').textContent = 'HO√ÄN TH√ÄNH!';
            $('#current-icon').textContent = 'üèÜ';
        }

        // Kh·ªüi ƒë·ªông khi t·∫£i trang
        window.onload = initGame;
    </script>
</body>
</html>
